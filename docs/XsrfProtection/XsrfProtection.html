<html>
<head>
<title>Docs For Class XsrfProtection</title>
<link rel="stylesheet" type="text/css" href="../media/style.css">
</head>
<body>

<table border="0" cellspacing="0" cellpadding="0" height="48" width="100%">
  <tr>
    <td class="header_top">XsrfProtection</td>
  </tr>
  <tr><td class="header_line"><img src="../media/empty.png" width="1" height="1" border="0" alt=""  /></td></tr>
  <tr>
    <td class="header_menu">
        
                                    
                              		  [ <a href="../classtrees_XsrfProtection.html" class="menu">class tree: XsrfProtection</a> ]
		  [ <a href="../elementindex_XsrfProtection.html" class="menu">index: XsrfProtection</a> ]
		  	    [ <a href="../elementindex.html" class="menu">all elements</a> ]
    </td>
  </tr>
  <tr><td class="header_line"><img src="../media/empty.png" width="1" height="1" border="0" alt=""  /></td></tr>
</table>

<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="200" class="menu">
      <b>Packages:</b><br />
              <a href="../li_XsrfProtection.html">XsrfProtection</a><br />
            <br /><br />
                        <b>Files:</b><br />
      	  <div class="package">
			<a href="../XsrfProtection/_XsrfProtection.php.html">		XsrfProtection.php
		</a><br>
	  </div><br />
      
      
            <b>Classes:</b><br />
        <div class="package">
		    		<a href="../XsrfProtection/XsrfProtection.html">XsrfProtection</a><br />
	  </div>
                </td>
    <td>
      <table cellpadding="10" cellspacing="0" width="100%" border="0"><tr><td valign="top">

<h1>Class: XsrfProtection</h1>
Source Location: /XsrfProtection.php<br /><br />


<table width="100%" border="0">
<tr><td valign="top">

<h3><a href="#class_details">Class Overview</a></h3>
<pre></pre><br />
<div class="description">Simple XSRF Protection</div><br /><br />
<h4>Author(s):</h4>
<ul>
        </ul>




    

        
</td>


<td valign="top">
<h3><a href="#class_consts">Constants</a></h3>
<ul>
    <li><a href="../XsrfProtection/XsrfProtection.html#constkCheckExpired">kCheckExpired</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#constkCheckInvalid">kCheckInvalid</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#constkCheckMissing">kCheckMissing</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#constkCheckReused">kCheckReused</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#constkCheckSuccess">kCheckSuccess</a></li>
  </ul>
</td>

<td valign="top">
<h3><a href="#class_methods">Methods</a></h3>
<ul>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodError">Error</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodProtectionField">ProtectionField</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodProtectionFieldValue">ProtectionFieldValue</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodSetFieldName">SetFieldName</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodSetKey">SetKey</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodSetStateful">SetStateful</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodSetTimeout">SetTimeout</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodSetUrl">SetUrl</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodSetUserData">SetUserData</a></li>
    <li><a href="../XsrfProtection/XsrfProtection.html#methodValidate">Validate</a></li>
  </ul>
</td>

</tr></table>
<hr />

<table width="100%" border="0"><tr>






</tr></table>
<hr />

<a name="class_details"></a>
<h3>Class Details</h3>
<div class="tags">
[line 36]<br />
Simple XSRF Protection<br /><br /><p>This class provides a simple method of protecting form submission from  common Cross Site Request Forgery (XSRF) attacks.</p><p>Protection is accomplished by adding a randomised hidden field to forms that  are checked when the form is processed. If the hidden field doesn't exist,  or is modified then the request should be rejected.</p><p>The method used is stateless and does not require any session management to  be used. This allows the request to be easily handled by a load balanced  cluster of frontends that don't share session information.</p><p>Protection against replay attacks can also be provided using this same  method, but requiring session local storage which makes this stateful, and  requires distributed session management if multiple web servers are being  used.</p><br /><br /><br />
<h4>Tags:</h4>
<div class="tags">
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><b>example:</b>&nbsp;&nbsp;</td><td><a href="../__examplesource/exsource__home_dparrish_src_xsrfprotect_example.php_c474f583012319c94b471e7aecb366d3.html">Sample usage</a></td>
  </tr>
</table>
</div>
</div><br /><br />
<div class="top">[ <a href="#top">Top</a> ]</div><br />


<hr />
<a name="class_methods"></a>
<h3>Class Methods</h3>
<div class="tags">

  <hr />
	<a name="methodError"></a>
	<h3>method Error <span class="smalllinenumber">[line 261]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>string Error(
)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Get a human-readable explanation of why the request was rejected.<br /><br /><p>This is suitable for printing, but it's recommended that it's not shown to  users, as it may help an attacker devise a better attack.</p><br /><br /><br />
<h4>Tags:</h4>
<div class="tags">
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><b>return:</b>&nbsp;&nbsp;</td><td>The error message for the last validation.</td>
  </tr>
</table>
</div>
<br /><br />

	
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodProtectionField"></a>
	<h3>method ProtectionField <span class="smalllinenumber">[line 167]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>string ProtectionField(
)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Return the hidden input field that contains the secret token.<br /><br /><p>This is the only method you are required to call when generating the form.</p><br /><br /><br />
<h4>Tags:</h4>
<div class="tags">
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><b>return:</b>&nbsp;&nbsp;</td><td>The complete &lt;input&gt; tag suitable for printing.</td>
  </tr>
</table>
</div>
<br /><br />

	
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodProtectionFieldValue"></a>
	<h3>method ProtectionFieldValue <span class="smalllinenumber">[line 149]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>string ProtectionFieldValue(
)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Get the value that would be set in the hidden field.<br /><br /><p>You could for example use this in a GET request.</p><br /><br /><br />
<h4>Tags:</h4>
<div class="tags">
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><b>return:</b>&nbsp;&nbsp;</td><td>The token value</td>
  </tr>
</table>
</div>
<br /><br />

	
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodSetFieldName"></a>
	<h3>method SetFieldName <span class="smalllinenumber">[line 138]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>void SetFieldName(
string
$field)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Sert a custom token field name. By default this is __xsrfprotect_tok. If  that doesn't fit in with your field naming scheme, you can choose another  one with this method.<br /><br /><br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">string&nbsp;&nbsp;</td>
        <td><b>$field</b>&nbsp;&nbsp;</td>
        <td>The new field name. This must not be used for any other purpose.</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodSetKey"></a>
	<h3>method SetKey <span class="smalllinenumber">[line 70]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>void SetKey(
string
$key)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Sets the hash secret key.<br /><br /><p>This is required for the protection to work. If you don't set this key,  you will get a PHP error in the log.</p><p>DO NOT use the example key, as it is the only protection provided by this  class. If you use the example key, forging requests becomes trivial.</p><br /><br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">string&nbsp;&nbsp;</td>
        <td><b>$key</b>&nbsp;&nbsp;</td>
        <td>The new hash secret key</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodSetStateful"></a>
	<h3>method SetStateful <span class="smalllinenumber">[line 115]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>void SetStateful(
[bool
$stateful = true])</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Enable stateful mode.<br /><br /><p>Stateful mode adds an extra level of security, only allowing tokens to be  used a single time. This prevents replay attacks, but requires use of the  PHP session cache.</p><p>Be sure you call session_start() beforre trying to use the stateful  mode.</p><br /><br /><br />
<h4>Tags:</h4>
<div class="tags">
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><b>see:</b>&nbsp;&nbsp;</td><td><a href="http://www.php.net/session_start">session_start()</a></td>
  </tr>
</table>
</div>
<br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">bool&nbsp;&nbsp;</td>
        <td><b>$stateful</b>&nbsp;&nbsp;</td>
        <td>Whether stateful mode should be enabled.</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodSetTimeout"></a>
	<h3>method SetTimeout <span class="smalllinenumber">[line 127]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>void SetTimeout(
int
$age)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Set the maximum age of tokens.<br /><br /><p>If a request is received with a token that is older than this, it is  rejected.</p><br /><br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">int&nbsp;&nbsp;</td>
        <td><b>$age</b>&nbsp;&nbsp;</td>
        <td>The maximum age of tokens in seconds. This defaults to 1  hour if not specified.</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodSetUrl"></a>
	<h3>method SetUrl <span class="smalllinenumber">[line 98]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>void SetUrl(
string
$url)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Sets the target URL.<br /><br /><p>This provides an extra level of security by adding another checked field  into the security token. This is not checked against the actual URL of the  script, so it's up to the author to ensure it's something useful.</p><br /><br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">string&nbsp;&nbsp;</td>
        <td><b>$url</b>&nbsp;&nbsp;</td>
        <td>New target URL</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodSetUserData"></a>
	<h3>method SetUserData <span class="smalllinenumber">[line 85]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>void SetUserData(
string
$data)</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Sets the user data.<br /><br /><p>Use user data to provide an extra level of security. The data will be used  as part of the security token, so must be reproducable when verifying the  token.</p><p>It's recommended that a username or user ID is used for this field.</p><br /><br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">string&nbsp;&nbsp;</td>
        <td><b>$data</b>&nbsp;&nbsp;</td>
        <td>New user data</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
  <hr />
	<a name="methodValidate"></a>
	<h3>method Validate <span class="smalllinenumber">[line 194]</span></h3>
	<div class="function">
    <table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td class="code_border">
    <table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td class="code">
		<code>int Validate(
[array
$req = null])</code>
    </td></tr></table>
    </td></tr></table><br />
	
		Validates the supplied token.<br /><br /><p>This is the only method you are required to call when validating the  token. It performas all the checks of the token. You can pass in an array  of request variables, and it's recommended that you either pass in $_GET  or $_POST, depending on how you expect your form to be received.</p><p>This will return one of the kCheck* constants which can be used to see why  the request was rejected. A return value of 0 indicates success (a valid  request).</p><br /><br /><br />
<h4>Tags:</h4>
<div class="tags">
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><b>return:</b>&nbsp;&nbsp;</td><td>Success or failure of the validation. 0 is success.</td>
  </tr>
</table>
</div>
<br /><br />

	
        <h4>Parameters:</h4>
    <div class="tags">
    <table border="0" cellspacing="0" cellpadding="0">
          <tr>
        <td class="type">array&nbsp;&nbsp;</td>
        <td><b>$req</b>&nbsp;&nbsp;</td>
        <td>The request fields, defaults to $_REQUEST</td>
      </tr>
        </table>
    </div><br />
        <div class="top">[ <a href="#top">Top</a> ]</div>
  </div>
</div><br />

<hr />
<a name="class_consts"></a>
<h3>Class Constants</h3>
<div class="tags">
	<a name="constkCheckExpired"></a>
	<p></p>
	<h4>kCheckExpired = <span class="value">&nbsp;2</span></h4>
	<p>[line 49]</p>
  Validation failed, the security token has expired.<br /><br />
  <br />
	<div class="top">[ <a href="#top">Top</a> ]</div><br />
	<a name="constkCheckInvalid"></a>
	<p></p>
	<h4>kCheckInvalid = <span class="value">&nbsp;1</span></h4>
	<p>[line 45]</p>
  Validation failed, the security token was invalid.<br /><br />
  <br />
	<div class="top">[ <a href="#top">Top</a> ]</div><br />
	<a name="constkCheckMissing"></a>
	<p></p>
	<h4>kCheckMissing = <span class="value">&nbsp;3</span></h4>
	<p>[line 53]</p>
  Validation failed, the security token was missing.<br /><br />
  <br />
	<div class="top">[ <a href="#top">Top</a> ]</div><br />
	<a name="constkCheckReused"></a>
	<p></p>
	<h4>kCheckReused = <span class="value">&nbsp;4</span></h4>
	<p>[line 57]</p>
  Validation failed, the security token had already been used.<br /><br />
  <br />
	<div class="top">[ <a href="#top">Top</a> ]</div><br />
	<a name="constkCheckSuccess"></a>
	<p></p>
	<h4>kCheckSuccess = <span class="value">&nbsp;0</span></h4>
	<p>[line 41]</p>
  Validation successful, this is likely not a forged request.<br /><br />
  <br />
	<div class="top">[ <a href="#top">Top</a> ]</div><br />
</div><br />

        <div class="credit">
		    <hr />
		    Documentation generated on Thu, 28 Oct 2010 15:42:34 +1100 by <a href="http://www.phpdoc.org">phpDocumentor 1.4.3</a>
	      </div>
      </td></tr></table>
    </td>
  </tr>
</table>

</body>
</html>